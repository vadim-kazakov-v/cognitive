<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cognitive Bias Visualizer</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body class="container py-4">
  <h1 class="mb-4 text-center">Cognitive Bias Explorer</h1>
  <div id="chart"></div>

  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>
  fetch('/api/biases').then(res => res.json()).then(data => {
    const counts = Array.from(d3.rollup(data, v => v.length, d => d.category), ([category, count]) => ({category, count}));
    const width = 600, height = 400;
    const svg = d3.select('#chart').append('svg').attr('width', width).attr('height', height);
    const pack = d3.pack().size([width, height]).padding(10);
    const root = d3.hierarchy({children: counts}).sum(d => d.count);
    const nodes = pack(root).leaves();
    const color = d3.scaleOrdinal(d3.schemeSet2);
    const node = svg.selectAll('g').data(nodes).enter().append('g').attr('transform', d => `translate(${d.x},${d.y})`);
    node.append('circle').attr('r', d => d.r).attr('fill', d => color(d.data.category));
    node.append('text').attr('text-anchor', 'middle').attr('dy', '.3em').text(d => d.data.category);
  });
  </script>
</body>
</html>
